<!doctype html>
<html>
  <head>
    <title>Name that tune</title>
  </head>
  <body>
  <p> HELLO WORLD </p>
   <form id="send-song">
      <input id="search" autocomplete="off" /><button id="submit">SUBMIT</button>
  </form>
  <form id="send-guess" style="display: none;">
    <input id="song" autocomplete="off" /><button id="submit">GUESS</button>
  </form>
  <h2 id="answer"></h2>
  <div id="spotify"></div>

<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>

<script>
var socket = io();
var $btn = $('#spotify');
var $track;
var match;
$('#send-song').submit(function(e){
    e.preventDefault();
    socket.emit('parse spotify', $('#search').val());
    $('#search').val('');
    $('#answer').text("")
});

$('#send-guess').submit(function(e){
  e.preventDefault();
  if ($('#song').val().toLowerCase() === match){
      $('#answer').text("CORRECT")
      $('iframe').css({opacity: '1'})
      $('#send-song').css({display: ""})
      $('#send-guess').css({display: "none"})
      $('#song').val('');
  } else {
      $('#answer').text("GUESS AGAIN")
  }
});

  socket.on('parse spotify', function(song){
    var link = song.uri;
    $track = song.name;
    getSongName(song.name);
    $('#spotify').html("<h1 id='play-button'>PLAY</h1><iframe src='https://embed.spotify.com/?uri=spotify:track:"+link+"'  width='300' height='380' frameborder='0' allowtransparency='true' style='opacity: .4; margin-top: -70px;'></iframe>");
    $('#send-song').css({display: "none"})
    $('#send-guess').css({display: ""})
  });

  function getSongName(track) {
    if ($track.match(/[(]/)) {
      match = $track.match(/(.*)[(]/)[1].toLowerCase().trim();
    } else if ($track.match(/[[]/)) {
      match = $track.match(/(.*)[[]/)[1].toLowerCase().trim();
    } else if ($track.match(/[-]/)) {
      match = $track.match(/(.*)[-]/)[1].toLowerCase().trim();
    } else {
      match = track.toLowerCase();
    }
  }

</script>

  </body>
</html>


